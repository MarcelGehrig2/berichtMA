% \chapter{Anhang}


% Zybo
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%




% openOCD
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Schema Zybo}
\label{anhang:schemaZybo}

% \label{anhang:zybo-ftdi.cfg-orig}
% \textit{zybo-ftdi.ocd original:}
% \lstset{language=tcl}
% \begin{lstlisting}
% #
% # ZYBO ft2232hq usbserial jtag
% #

% interface ftdi
% ftdi_device_desc "Digilent Adept USB Device"
% ftdi_vid_pid 0x0403 0x6010

% ftdi_layout_init 0x3088 0x1f8b
% #ftdi_layout_signal nTRST -data 0x1000 -oe 0x1000
% # 0x2000 is reset
% ftdi_layout_signal nSRST -data 0x3000 -oe 0x1000
% # green MIO7 LED
% ftdi_layout_signal LED -data 0x0010
% #ftdi_layout_signal LED -data 0x1000

% reset_config srst_pulls_trst
% \end{lstlisting}


\section{zybo-ftdi.ocd angepasst:}
\label{anhang:zybo-ftdi.cfg}
\lstset{language=tcl}
\begin{lstlisting}
#
# FTDI2232 on Zybo
#
#  https://github.com/f32c/f32c/blob/master/rtl/proj/xilinx/zybo/xram_bram_hdmi_ise/ftdi-zybo.ocd 

interface ftdi
ftdi_device_desc "Digilent Adept USB Device"
ftdi_vid_pid 0x0403 0x6010

#ftdi_layout_init data direction
ftdi_layout_init 0x3088 0x1f8b

ftdi_layout_signal nSRST -data 0x3000 -oe 0x3000

# green MIO7 LED
ftdi_layout_signal LED -data 0x0010

reset_config srst_only
adapter_nsrst_delay 40
\end{lstlisting}

\label{anhang:zynq_7000.cfg}




\section{Xilinx SDK Log:}
\label{anhang:SDKLog}
\lstset{language=plain}
\begin{lstlisting}
14:26:34 INFO	: Disconnected from the channel tcfchan#2.
14:26:36 INFO	: 'targets -set -filter {jtag_cable_name =~ "Digilent Zybo 210279573773A" && level==0} -index 1' command is executed.
14:26:36 INFO	: 'fpga -state' command is executed.
14:26:36 INFO	: Connected to target on host '127.0.0.1' and port '3121'.
14:26:36 INFO	: Jtag cable 'Digilent Zybo 210279573773A' is selected.
14:26:36 INFO	: 'jtag frequency' command is executed.
14:26:36 INFO	: Sourcing of 'D:/Vivado/01_gettingStarted/01_gettingStarted.sdk/design_1_wrapper_hw_platform_0/ps7_init.tcl' is done.
14:26:36 INFO	: Context for 'APU' is selected.
14:26:38 INFO	: Hardware design information is loaded from 'D:/Vivado/01_gettingStarted/01_gettingStarted.sdk/design_1_wrapper_hw_platform_0/system.hdf'.
14:26:38 INFO	: 'configparams force-mem-access 1' command is executed.
14:26:38 INFO	: Context for 'APU' is selected.
14:26:38 INFO	: 'stop' command is executed.
14:26:38 INFO	: 'ps7_init' command is executed.
14:26:38 INFO	: 'ps7_post_config' command is executed.
14:26:38 INFO	: Context for processor 'ps7_cortexa9_0' is selected.
14:26:38 INFO	: Processor reset is completed for 'ps7_cortexa9_0'.
14:26:38 INFO	: Context for processor 'ps7_cortexa9_0' is selected.
14:26:39 INFO	: The application 'D:/Vivado/01_gettingStarted/01_gettingStarted.sdk/01_gettingStarted_ApplicationProject/Debug/01_gettingStarted_ApplicationProject.elf' is downloaded to processor 'ps7_cortexa9_0'.
14:26:39 INFO	: 'configparams force-mem-access 0' command is executed.
14:26:39 INFO	: ----------------XSDB Script----------------
connect -url tcp:127.0.0.1:3121
source D:/Vivado/01_gettingStarted/01_gettingStarted.sdk/design_1_wrapper_hw_platform_0/ps7_init.tcl
targets -set -nocase -filter {name =~"APU*" && jtag_cable_name =~ "Digilent Zybo 210279573773A"} -index 0
loadhw -hw D:/Vivado/01_gettingStarted/01_gettingStarted.sdk/design_1_wrapper_hw_platform_0/system.hdf -mem-ranges [list {0x40000000 0xbfffffff}]
configparams force-mem-access 1
targets -set -nocase -filter {name =~"APU*" && jtag_cable_name =~ "Digilent Zybo 210279573773A"} -index 0
stop
ps7_init
ps7_post_config
targets -set -nocase -filter {name =~ "ARM*#0" && jtag_cable_name =~ "Digilent Zybo 210279573773A"} -index 0
rst -processor
targets -set -nocase -filter {name =~ "ARM*#0" && jtag_cable_name =~ "Digilent Zybo 210279573773A"} -index 0
dow D:/Vivado/01_gettingStarted/01_gettingStarted.sdk/01_gettingStarted_ApplicationProject/Debug/01_gettingStarted_ApplicationProject.elf
configparams force-mem-access 0
----------------End of Script----------------

14:26:39 INFO	: Memory regions updated for context APU
14:26:39 INFO	: Context for processor 'ps7_cortexa9_0' is selected.
14:26:39 INFO	: 'con' command is executed.
14:26:39 INFO	: ----------------XSDB Script (After Launch)----------------
targets -set -nocase -filter {name =~ "ARM*#0" && jtag_cable_name =~ "Digilent Zybo 210279573773A"} -index 0
con
----------------End of Script----------------

14:26:39 INFO	: Launch script is exported to file 'D:\Vivado\01_gettingStarted\01_gettingStarted.sdk\.sdk\launch_scripts\xilinx_c-c++_application_(system_debugger)\system_debugger_using_debug_01_gettingstarted_applicationproject.elf_on_local.tcl'
\end{lstlisting}


\section{system\_debugger\_using\_debug\_01\_gettingstarted\_applicationproject.elf\_on\_local.tcl:}
\label{anhang:elf_on_local.tcl}
\lstset{language=plain}
\begin{lstlisting}
connect -url tcp:127.0.0.1:3121
source D:/Vivado/01_gettingStarted/01_gettingStarted.sdk/design_1_wrapper_hw_platform_0/ps7_init.tcl
targets -set -nocase -filter {name =~"APU*" && jtag_cable_name =~ "Digilent Zybo 210279573773A"} -index 0
loadhw -hw D:/Vivado/01_gettingStarted/01_gettingStarted.sdk/design_1_wrapper_hw_platform_0/system.hdf -mem-ranges [list {0x40000000 0xbfffffff}]
configparams force-mem-access 1
targets -set -nocase -filter {name =~"APU*" && jtag_cable_name =~ "Digilent Zybo 210279573773A"} -index 0
stop
ps7_init
ps7_post_config
targets -set -nocase -filter {name =~ "ARM*#0" && jtag_cable_name =~ "Digilent Zybo 210279573773A"} -index 0
rst -processor
targets -set -nocase -filter {name =~ "ARM*#0" && jtag_cable_name =~ "Digilent Zybo 210279573773A"} -index 0
dow D:/Vivado/01_gettingStarted/01_gettingStarted.sdk/01_gettingStarted_ApplicationProject/Debug/01_gettingStarted_ApplicationProject.elf
configparams force-mem-access 0
targets -set -nocase -filter {name =~ "ARM*#0" && jtag_cable_name =~ "Digilent Zybo 210279573773A"} -index 0
con
\end{lstlisting}







\section{STABS}
\label{anhang:stabs}


\subsection{stabs.include:}
\label{anhang:stabs.include}
\lstset{language={[x86masm]Assembler}}
\begin{lstlisting}
# non-stab symbol types
.set N_UNDF,		0x0
.set N_EXT,			0x1
.set N_ABS,			0x2
.set N_TEXT,		0x4
.set N_DATA,		0x6
.set N_BSS,			0x8
.set N_FN_SEQ,		0x0c
.set N_INDR,		0x0a
.set N_COMM,		0x12
.set N_SETA,		0x14
.set N_SETT,		0x16
.set N_SETD,		0x18
.set N_SETB,		0x1a
.set N_SETV,		0x1c
.set N_WARNING,		0x1e
.set N_FN,			0x1f

# stab symbol types
.set N_GSYM,		0x20
.set N_FNAME,		0x22
.set N_FUN,			0x24
.set N_STSYM,		0x26
.set N_LCSYM,		0x28
.set N_MAIN,		0x2a
.set N_ROSYM,		0x2c
.set N_PC,			0x30
.set N_NSYMS,		0x32
.set N_NOMAP,		0x34
.set N_MAC_DEFINE,	0x36
.set N_OBJ,			0x38
.set N_MAC_UNDEF,	0x3a
.set N_OPT,			0x3c
.set N_RSYM,		0x40
.set N_M2C,			0x42
.set N_SLINE,		0x44
.set N_DSLINE,		0x46
.set N_BSLINE,		0x48
.set N_BROWS,		0x48
.set N_DEFD,		0x4a
.set N_FLINE,		0x4c
.set N_EHDECL,		0x50
.set N_MOD2,		0x50
.set N_CATCH,		0x54
.set N_SSYM,		0x60
.set N_ENDM,		0x62
#.set N_SO,			0x100
.set N_SO,			0x64
.set N_LSYM,		0x80
.set N_BINCL,		0x82
.set N_SOL,			0x84
.set N_PSYM,		0xa0
.set N_EINCL,		0xa2
.set N_ENTRY,		0xa4
.set N_LBRAC,		0xc0
.set N_EXCL,		0xc2
.set N_SCOPE,		0xc4
.set N_RBRAC,		0xe0
.set N_BCOMM,		0xe2
.set N_ECOMM,		0xe4
.set N_ECOML,		0xe8
.set N_WITH,		0xea
.set N_NBTEXT,		0xf0
.set N_NBDATA,		0xf2
.set N_NBBSS,		0xf4
.set N_NBSTS,		0xf6
.set N_NBLCS,		0xf8
\end{lstlisting}


\subsection{Reset.Java:}
\label{anhang:reset.java}
\lstset{language=java}
\begin{lstlisting}
/*
 * Copyright 2011 - 2013 NTB University of Applied Sciences in Technology
 * Buchs, Switzerland, http://www.ntb.ch/inf
 * 
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * 
 * http://www.apache.org/licenses/LICENSE-2.0
 *   
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * 
 */

package ch.ntb.inf.deep.runtime.zynq7000;
import ch.ntb.inf.deep.runtime.IdeepCompilerConstants;
import ch.ntb.inf.deep.runtime.arm32.Iarm32;
import ch.ntb.inf.deep.runtime.arm32.ARMException;
import ch.ntb.inf.deep.unsafe.US;

/* changes:
 * 13.05.16	NTB/Urs Graf	creation
 */
/**
 * The class for the ARM reset exception.
 * The stack pointer will be initialized and the program counter will be
 * set to the beginning of the class initializer of the kernel.
 * 
 * @author Urs Graf
 */
class Reset extends ARMException implements Iarm32, Izybo7000, IdeepCompilerConstants {
//	static int g = 5555;
	
	static void reset() {
		int stackOffset = US.GET4(sysTabBaseAddr + stStackOffset);
		int stackBase = US.GET4(sysTabBaseAddr + stackOffset + 4);
		int stackSize = US.GET4(sysTabBaseAddr + stackOffset + 8);
		US.PUTGPR(SP, stackBase + stackSize - 4);	// set stack pointer
		
		int x00 = 0;
		int x01 = 10;
		int x02 = 20;
		x00++;
		x01++;
		x02++;
		
		int x100 = 100;
		for(int i=0; i<10; i++){
            x100 += 10;
       }
		
		x100++;
		x100++;
		x100++;
		x100++;
		x100++;

		US.ASM("b -8"); // stop here

	}	
}
\end{lstlisting}




\subsection{loopMachineCode.txt:}
\label{anhang:loopMachineCode.txt}
\lstset{language=plain}
\begin{lstlisting}
Code for Method: ch/ntb/inf/deep/runtime/zynq7000/Reset.reset()V
	E3010004	[0x0]	movw R0, #4100
	E4101000	[0x4]	ldr R1, [R0], #-0
	E2810D40	[0x8]	add R0, R1, #4096
	E2802004	[0xc]	add R2, R0, #4
	E4120000	[0x10]	ldr R0, [R2], #-0
	E2812D40	[0x14]	add R2, R1, #4096
	E2821008	[0x18]	add R1, R2, #8
	E4112000	[0x1c]	ldr R2, [R1], #-0
	E0801002	[0x20]	add R1, R0, R2, 0
	E2410004	[0x24]	sub R0, R1, #4
	E1A0D000	[0x28]	mov R13, R0
	E3000000	[0x2c]	movw R0, #0
	E300100A	[0x30]	movw R1, #10
	E3002014	[0x34]	movw R2, #20
	E2803001	[0x38]	add R3, R0, #1
	E2810001	[0x3c]	add R0, R1, #1
	E2820001	[0x40]	add R0, R2, #1
	E3000064	[0x44]	movw R0, #100
	E3001000	[0x48]	movw R1, #0
	EA000001	[0x4c]	b 12, [0x58]	
	E280000A	[0x50]	add R0, R0, #10
	E2811001	[0x54]	add R1, R1, #1
	E351000A	[0x58]	cmp R1, #10
	BAFFFFFB	[0x5c]	b if less -12, [0x50]	
	E2801001	[0x60]	add R1, R0, #1
	E2810001	[0x64]	add R0, R1, #1
	E2801001	[0x68]	add R1, R0, #1
	E2810001	[0x6c]	add R0, R1, #1
	E2801001	[0x70]	add R1, R0, #1
	EAFFFFFE	[0x74]	b 0, [0x74]	
\end{lstlisting}


\subsection{loop.S:}
\label{anhang:loop.S}
\lstset{language={[x86masm]Assembler}}
\begin{lstlisting}
.global _start

.org 0x000000
.text
Ltext0:

_start:
_reset:
c_entry:
movw R0, #1024

movw R0, #0
movw R1, #10
movw R2, #20
add R3, R0, #1
add R0, R1, #1
add R0, R2, #1
movw R0, #100
movw R1, #0
b CHECK_LOOP_EXIT	
START_LOOP_BODY:
add R0, R0, #10
add R1, R1, #1
CHECK_LOOP_EXIT:
cmp R1, #10
blt START_LOOP_BODY
add R1, R0, #1
add R0, R1, #1
add R1, R0, #1
add R0, R1, #1
add R1, R0, #1
b 0
\end{lstlisting}
